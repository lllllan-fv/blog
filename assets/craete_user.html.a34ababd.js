import{_ as n}from"./plugin-vue_export-helper.21dcd24c.js";import{d as s}from"./app.af53d2d3.js";var a="/assets/image-20220526153853638.c592b134.png",p="/assets/image-20220526160009253.fbb01cbd.png";const t={},e=s(`<h2 id="\u7528\u6237" tabindex="-1"><a class="header-anchor" href="#\u7528\u6237" aria-hidden="true">#</a> \u7528\u6237</h2><p>\u6211\u4EEC\u628A\u6BCF\u4E00\u4E2A\u5BA2\u6237\u7AEF\u90FD\u5F53\u4F5C\u662F\u4E00\u4E2A\u7528\u6237\uFF0C\u6BCF\u4E2A\u7528\u6237\u5E94\u5F53\u62E5\u6709\u81EA\u5DF1\u7684\u4FE1\u606F\u3001\u5E76\u4E14\u80FD\u591F\u8BF7\u6C42\u4E00\u5B9A\u7684\u529F\u80FD\u3002</p><h3 id="\u7528\u6237\u7C7B" tabindex="-1"><a class="header-anchor" href="#\u7528\u6237\u7C7B" aria-hidden="true">#</a> \u7528\u6237\u7C7B</h3><p>\u5355\u72EC\u521B\u5EFA\u4E00\u4E2A <code>user.go</code> \uFF0C\u6211\u4EEC\u5728\u6B64\u5904\u5B9A\u4E49\u7528\u6237\u7C7B\u3002</p><ul><li>Name\uFF0C\u540E\u671F\u6709\u4E00\u4E2A\u4FEE\u6539\u7528\u6237\u540D\u7684\u529F\u80FD\uFF0C\u56E0\u6B64\u6B64\u5904\u63D0\u4F9B\u4E00\u4E2A\u5B57\u6BB5\u4FDD\u5B58\u7528\u6237\u540D\u4FE1\u606F</li><li>conn\uFF0C\u6700\u91CD\u8981\u7684\u5B57\u6BB5\uFF0C\u6807\u8BC6\u6BCF\u4E00\u4E2A\u8FDE\u63A5\u8BF7\u6C42</li><li>message\uFF0C\u7528\u4E8E\u548C server \u8FDB\u884C\u901A\u4FE1</li></ul><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token string">&quot;net&quot;</span>

<span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	Name <span class="token builtin">string</span>
	conn net<span class="token punctuation">.</span>Conn

	<span class="token comment">// \u6D88\u606F\u63A5\u6536</span>
	message <span class="token keyword">chan</span> <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">NewUser</span><span class="token punctuation">(</span>conn net<span class="token punctuation">.</span>Conn<span class="token punctuation">)</span> <span class="token operator">*</span>User <span class="token punctuation">{</span>
	addr <span class="token operator">:=</span> conn<span class="token punctuation">.</span><span class="token function">RemoteAddr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	user <span class="token operator">:=</span> <span class="token operator">&amp;</span>User<span class="token punctuation">{</span>
		Name<span class="token punctuation">:</span>    addr<span class="token punctuation">,</span>
		conn<span class="token punctuation">:</span>    conn<span class="token punctuation">,</span>
		message<span class="token punctuation">:</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">return</span> user
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h3 id="server-\u4E2D\u4E3A\u6BCF\u4E00\u6B21\u8BF7\u6C42\u90FD\u521B\u5EFA\u76F8\u5173\u7684\u7528\u6237" tabindex="-1"><a class="header-anchor" href="#server-\u4E2D\u4E3A\u6BCF\u4E00\u6B21\u8BF7\u6C42\u90FD\u521B\u5EFA\u76F8\u5173\u7684\u7528\u6237" aria-hidden="true">#</a> server \u4E2D\u4E3A\u6BCF\u4E00\u6B21\u8BF7\u6C42\u90FD\u521B\u5EFA\u76F8\u5173\u7684\u7528\u6237</h3><p>\uFF08\u4FEE\u6539 <code>server.go/Handler()</code> \u51FD\u6570\uFF09</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token punctuation">(</span>this <span class="token operator">*</span>Server<span class="token punctuation">)</span> <span class="token function">Handler</span><span class="token punctuation">(</span>conn net<span class="token punctuation">.</span>Conn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	user <span class="token operator">:=</span> <span class="token function">NewUser</span><span class="token punctuation">(</span>conn<span class="token punctuation">)</span>

	<span class="token comment">// \u5728\u5F00\u542F server \u7684\u7EC8\u7AEF\u4E2D\u6253\u5370\u4FE1\u606F</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;[&quot;</span> <span class="token operator">+</span> user<span class="token punctuation">.</span>Name <span class="token operator">+</span> <span class="token string">&quot;]\u5EFA\u7ACB\u8FDE\u63A5...&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">defer</span> fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;[&quot;</span> <span class="token operator">+</span> user<span class="token punctuation">.</span>Name <span class="token operator">+</span> <span class="token string">&quot;]\u5173\u95ED\u8FDE\u63A5...&quot;</span><span class="token punctuation">)</span>

	<span class="token comment">// \u5F53\u524D\u8FDE\u63A5\u7684\u7EC8\u7AEF\u6253\u5370\u4FE1\u606F</span>
	conn<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;\u5EFA\u7ACB\u8FDE\u63A5...\\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">defer</span> conn<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">defer</span> conn<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;\u5173\u95ED\u8FDE\u63A5...\\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="\u6D4B\u8BD5\u7ED3\u679C" tabindex="-1"><a class="header-anchor" href="#\u6D4B\u8BD5\u7ED3\u679C" aria-hidden="true">#</a> \u6D4B\u8BD5\u7ED3\u679C</h3><p><img src="`+a+`" alt="image-20220526153853638" loading="lazy"></p><h2 id="\u5E7F\u64AD\u6D88\u606F" tabindex="-1"><a class="header-anchor" href="#\u5E7F\u64AD\u6D88\u606F" aria-hidden="true">#</a> \u5E7F\u64AD\u6D88\u606F</h2><p>\u5B8C\u6210\u8FDE\u63A5\u53CA\u7528\u6237\u7684\u521B\u5EFA\u4E4B\u540E\uFF0C\u6211\u4EEC\u5C1D\u8BD5\u7740\u5C06\u5BA2\u6237\u7AEF\u7684\u8F93\u5165\uFF0C\u6253\u5370\u5230 server \u6216\u8005\u5176\u4ED6\u5BA2\u6237\u7AEF\u5904</p><h3 id="\u7EF4\u62A4\u5728\u7EBF\u7528\u6237\u5217\u8868" tabindex="-1"><a class="header-anchor" href="#\u7EF4\u62A4\u5728\u7EBF\u7528\u6237\u5217\u8868" aria-hidden="true">#</a> \u7EF4\u62A4\u5728\u7EBF\u7528\u6237\u5217\u8868</h3><p>\uFF08\u8865\u5145 <code>server.go/Server</code> \u7C7B\uFF09\u60F3\u8981\u5B9E\u73B0\u5E7F\u64AD\u529F\u80FD\uFF0C\u5148\u8981\u6709\u4E00\u4E2A\u5217\u8868\u7EF4\u62A4\u6240\u6709\u7684\u5728\u7EBF\u7528\u6237\uFF0C\u4E3A\u6B64\u6211\u4EEC\u5728 server \u7C7B\u4E2D\u8865\u5145\u4E00\u4E9B\u5B57\u6BB5</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> Server <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	Ip   <span class="token builtin">string</span>
	Port <span class="token builtin">int</span>

	<span class="token comment">// \u5728\u7EBF\u7528\u6237\u5217\u8868</span>
	UserMap <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">*</span>User
	mapLock sync<span class="token punctuation">.</span>RWMutex

	<span class="token comment">// \u5E7F\u64AD\u6D88\u606F</span>
	Message <span class="token keyword">chan</span> <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">newServer</span><span class="token punctuation">(</span>ip <span class="token builtin">string</span><span class="token punctuation">,</span> port <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">*</span>Server <span class="token punctuation">{</span>
	server <span class="token operator">:=</span> <span class="token operator">&amp;</span>Server<span class="token punctuation">{</span>
		Ip<span class="token punctuation">:</span>      ip<span class="token punctuation">,</span>
		Port<span class="token punctuation">:</span>    port<span class="token punctuation">,</span>
		UserMap<span class="token punctuation">:</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">*</span>User<span class="token punctuation">)</span><span class="token punctuation">,</span>
		Message<span class="token punctuation">:</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">return</span> server
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>\uFF08\u4FEE\u6539 <code>server.go/Handler()</code> \u51FD\u6570\uFF09\u5F53\u4E00\u4E2A\u5BA2\u6237\u7AEF\u8FDE\u63A5\u4E4B\u540E\uFF0C\u6211\u4EEC\u9700\u8981\u5C06\u8BE5\u7528\u6237\u4FE1\u606F\u52A0\u5165 UserMap \u5F53\u4E2D</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token punctuation">(</span>this <span class="token operator">*</span>Server<span class="token punctuation">)</span> <span class="token function">Handler</span><span class="token punctuation">(</span>conn net<span class="token punctuation">.</span>Conn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	user <span class="token operator">:=</span> <span class="token function">NewUser</span><span class="token punctuation">(</span>conn<span class="token punctuation">)</span>

	<span class="token comment">// \u5F53\u524D\u8FDE\u63A5\u7684\u7EC8\u7AEF\u6253\u5370\u4FE1\u606F</span>
	conn<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;\u5EFA\u7ACB\u8FDE\u63A5...\\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

	<span class="token comment">// \u4E0A\u7EBF\u52A0\u5165 UserMap</span>
	this<span class="token punctuation">.</span>mapLock<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	this<span class="token punctuation">.</span>UserMap<span class="token punctuation">[</span>user<span class="token punctuation">.</span>Addr<span class="token punctuation">]</span> <span class="token operator">=</span> user
	this<span class="token punctuation">.</span>mapLock<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="\u5BF9\u5BA2\u6237\u7AEF\u7684\u8F93\u5165\u8FDB\u884C\u5E7F\u64AD" tabindex="-1"><a class="header-anchor" href="#\u5BF9\u5BA2\u6237\u7AEF\u7684\u8F93\u5165\u8FDB\u884C\u5E7F\u64AD" aria-hidden="true">#</a> \u5BF9\u5BA2\u6237\u7AEF\u7684\u8F93\u5165\u8FDB\u884C\u5E7F\u64AD</h3><p><strong>\u670D\u52A1\u7AEF\u5E7F\u64AD\u6D88\u606F</strong></p><p>\uFF08\u6DFB\u52A0 <code>server.go/BroadCast()</code> \u51FD\u6570\uFF09\u4E3A\u5BA2\u6237\u7AEF\u63D0\u4F9B\u7684\u5E7F\u64AD\u6D88\u606F\u65B9\u6CD5\uFF0C\u4F1A\u5C06\u8BE5\u7528\u6237\u7684\u6D88\u606F\u5E7F\u64AD\u7ED9\u5176\u4ED6\u6240\u6709\u7684\u5728\u7EBF\u7528\u6237</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// BroadCast</span>
<span class="token comment">// - server \u5BF9\u6240\u6709\u7528\u6237\u8FDB\u884C\u5E7F\u64AD\u6D88\u606F</span>
<span class="token comment">// - user \u662F\u53D1\u9001\u6D88\u606F\u7684\u7528\u6237\uFF0C\u53EF\u4EE5\u4E3A nil</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>this <span class="token operator">*</span>Server<span class="token punctuation">)</span> <span class="token function">BroadCast</span><span class="token punctuation">(</span>user <span class="token operator">*</span>User<span class="token punctuation">,</span> msg <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	sendMsg <span class="token operator">:=</span> <span class="token string">&quot;[&quot;</span> <span class="token operator">+</span> user<span class="token punctuation">.</span>Name <span class="token operator">+</span> <span class="token string">&quot;]&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;:&quot;</span> <span class="token operator">+</span> msg

	this<span class="token punctuation">.</span>mapLock<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> toUser <span class="token operator">:=</span> <span class="token keyword">range</span> this<span class="token punctuation">.</span>UserMap <span class="token punctuation">{</span>
		<span class="token keyword">if</span> user <span class="token operator">!=</span> toUser <span class="token punctuation">{</span>
			toUser<span class="token punctuation">.</span>Message <span class="token operator">&lt;-</span> sendMsg
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	this<span class="token punctuation">.</span>mapLock<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><strong>\u76D1\u542C\u5BA2\u6237\u7AEF\u8F93\u5165</strong></p><ul><li>\uFF08\u6DFB\u52A0 <code>user.go/ListenWrite()</code> \u51FD\u6570\uFF09\u76D1\u542C\u5BA2\u6237\u7AEF\u7684\u8F93\u5165\u5E76\u8C03\u7528 server \u7684\u5E7F\u64AD\u51FD\u6570\uFF0C\u5C1D\u8BD5\u53D1\u9001\u7ED9\u5176\u4ED6\u5BA2\u6237\u7AEF</li></ul><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// ListenWrite \u76D1\u542C\u7528\u6237\u8F93\u5165</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>this <span class="token operator">*</span>User<span class="token punctuation">)</span> <span class="token function">ListenWrite</span><span class="token punctuation">(</span>server <span class="token operator">*</span>Server<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	buf <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> <span class="token number">4096</span><span class="token punctuation">)</span>

	<span class="token keyword">for</span> <span class="token punctuation">{</span>
		n<span class="token punctuation">,</span> err <span class="token operator">:=</span> this<span class="token punctuation">.</span>conn<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span>

		<span class="token comment">// \u7528\u6237\u4E0B\u7EBF\uFF0C\u4E0D\u518D\u53D1\u9001\u6D88\u606F</span>
		<span class="token keyword">if</span> n <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token operator">&amp;&amp;</span> err <span class="token operator">!=</span> io<span class="token punctuation">.</span>EOF <span class="token punctuation">{</span>
			fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;Conn Read err:&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
			<span class="token keyword">return</span>
		<span class="token punctuation">}</span>

		<span class="token comment">// \u83B7\u53D6\u7528\u6237\u8F93\u5165\uFF08\u53BB\u6389&#39;\\n&#39;\uFF09</span>
		msg <span class="token operator">:=</span> <span class="token function">string</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span><span class="token punctuation">:</span>n<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
		server<span class="token punctuation">.</span><span class="token function">BroadCast</span><span class="token punctuation">(</span>this<span class="token punctuation">,</span> msg<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><ul><li>\uFF08\u4FEE\u6539 <code>server.go/Handler()</code> \u51FD\u6570\uFF09\u4E3A\u6BCF\u4E00\u4E2A\u5BA2\u6237\u7AEF\u7684\u8FDE\u63A5\u5355\u72EC\u5F00\u542F\u4E00\u4E2A\u534F\u7A0B\u53BB\u76D1\u542C\u5BA2\u6237\u7AEF\u7684\u8F93\u5165</li></ul><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// Handler \u5904\u7406\u6BCF\u4E00\u4E2A\u8FDE\u63A5\u8BF7\u6C42</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>this <span class="token operator">*</span>Server<span class="token punctuation">)</span> <span class="token function">Handler</span><span class="token punctuation">(</span>conn net<span class="token punctuation">.</span>Conn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span>

	<span class="token comment">// server \u76D1\u542C\u8BE5\u7528\u6237\u7684\u8F93\u5165</span>
	<span class="token keyword">go</span> user<span class="token punctuation">.</span><span class="token function">ListenWrite</span><span class="token punctuation">(</span>this<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>\u5BA2\u6237\u7AEF\u76D1\u542C server \u7684\u5E7F\u64AD</strong></p><ul><li>\uFF08\u6DFB\u52A0 <code>user.go/ListenMessage()</code> \u51FD\u6570\uFF09server \u7684\u5E7F\u64AD\u662F\u5C06\u4FE1\u606F\u5199\u5165\u6BCF\u4E2A\u7528\u6237\u7684 Message \u5F53\u4E2D</li></ul><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// ListenMessage \u63A5\u6536 server \u53D1\u6765\u7684\u6D88\u606F</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>this <span class="token operator">*</span>User<span class="token punctuation">)</span> <span class="token function">ListenMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">for</span> <span class="token punctuation">{</span>
		msg <span class="token operator">:=</span> <span class="token operator">&lt;-</span>this<span class="token punctuation">.</span>Message
		this<span class="token punctuation">.</span><span class="token function">PrintMessage</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li>\uFF08\u8865\u5145 <code>user.go/NewUser()</code> \u51FD\u6570\uFF09\u5728\u521B\u5EFA\u7528\u6237\u65F6\u5F00\u542F\u4E00\u4E2A\u534F\u7A0B\u53BB\u76D1\u542C Message \u7684\u53D8\u5316</li></ul><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">NewUser</span><span class="token punctuation">(</span>conn net<span class="token punctuation">.</span>Conn<span class="token punctuation">)</span> <span class="token operator">*</span>User <span class="token punctuation">{</span>
	<span class="token operator">...</span>

	<span class="token keyword">go</span> user<span class="token punctuation">.</span><span class="token function">ListenMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token keyword">return</span> user
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li>\uFF08\u6DFB\u52A0 <code>user.go/PrintMessage()</code> \u51FD\u6570\uFF09\u5F53\u524D\u5BA2\u6237\u7AEF\u6253\u5370\u5C0F\u5FC3\u7684\u65B9\u6CD5</li></ul><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// PrintMessage \u7EC8\u7AEF\u6253\u5370\u6D88\u606F</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>this <span class="token operator">*</span>User<span class="token punctuation">)</span> <span class="token function">PrintMessage</span><span class="token punctuation">(</span>msg <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	conn <span class="token operator">:=</span> this<span class="token punctuation">.</span>conn
	conn<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>msg <span class="token operator">+</span> <span class="token string">&quot;\\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="\u6267\u884C\u6D4B\u8BD5" tabindex="-1"><a class="header-anchor" href="#\u6267\u884C\u6D4B\u8BD5" aria-hidden="true">#</a> \u6267\u884C\u6D4B\u8BD5</h3><p><img src="`+p+'" alt="image-20220526160009253" loading="lazy"></p>',36);function o(c,l){return e}var i=n(t,[["render",o],["__file","craete_user.html.vue"]]);export{i as default};
